#=============================================
#node-1 (fire some basic ddl and dml workload on node-1)
create table t1 (i int, primary key pk(i)) engine=innodb;
insert into t1 values (1), (2), (3), (4);
select * from t1;
i
1
2
3
4
create table t2 as (select * from t1);
insert into t2 values (10), (20), (30);
select * from t2;
i
1
2
3
4
10
20
30
create table t3 like t1;
begin;
insert into t3 values (100), (200), (300);
commit;
alter table t1 add column j int;
alter table t2 add key uk(i);
drop table t1, t2;
optimize table t3;
Table	Op	Msg_type	Msg_text
test.t3	optimize	note	Table does not support optimize, doing recreate + analyze instead
test.t3	optimize	status	OK
analyze table t3;
Table	Op	Msg_type	Msg_text
test.t3	analyze	status	OK
alter table t3 add column k int;
begin;
insert into t3 values (1000, 1000), (2000, 2000);
commit;
select * from t3;
i	k
100	NULL
200	NULL
300	NULL
1000	1000
2000	2000
SHOW BINLOG EVENTS IN 'mysqld-bin.000001' FROM 124;
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
mysqld-bin.000001	124	Previous_gtids	1	155	
mysqld-bin.000001	155	Anonymous_Gtid	1	228	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	228	Query	1	372	use `test`; create table t1 (i int, primary key pk(i)) engine=innodb /* xid=1 */
mysqld-bin.000001	372	Anonymous_Gtid	1	447	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	447	Query	1	529	BEGIN
mysqld-bin.000001	529	Table_map	1	577	table_id: 109 (test.t1)
mysqld-bin.000001	577	Write_rows	1	632	table_id: 109 flags: STMT_END_F
mysqld-bin.000001	632	Xid	1	663	COMMIT /* xid=2 */
mysqld-bin.000001	663	Anonymous_Gtid	1	736	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	736	Query	1	852	use `test`; CREATE TABLE `t2` (
  `i` int(11) NOT NULL
)
mysqld-bin.000001	852	Anonymous_Gtid	1	927	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	927	Query	1	1004	BEGIN
mysqld-bin.000001	1004	Table_map	1	1052	table_id: 110 (test.t2)
mysqld-bin.000001	1052	Write_rows	1	1107	table_id: 110 flags: STMT_END_F
mysqld-bin.000001	1107	Xid	1	1138	COMMIT /* xid=3 */
mysqld-bin.000001	1138	Anonymous_Gtid	1	1213	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1213	Query	1	1295	BEGIN
mysqld-bin.000001	1295	Table_map	1	1343	table_id: 110 (test.t2)
mysqld-bin.000001	1343	Write_rows	1	1393	table_id: 110 flags: STMT_END_F
mysqld-bin.000001	1393	Xid	1	1424	COMMIT /* xid=4 */
mysqld-bin.000001	1424	Anonymous_Gtid	1	1497	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1497	Query	1	1601	use `test`; create table t3 like t1 /* xid=5 */
mysqld-bin.000001	1601	Anonymous_Gtid	1	1676	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1676	Query	1	1758	BEGIN
mysqld-bin.000001	1758	Table_map	1	1806	table_id: 111 (test.t3)
mysqld-bin.000001	1806	Write_rows	1	1856	table_id: 111 flags: STMT_END_F
mysqld-bin.000001	1856	Xid	1	1887	COMMIT /* xid=6 */
mysqld-bin.000001	1887	Anonymous_Gtid	1	1960	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1960	Query	1	2079	use `test`; alter table t1 add column j int /* xid=7 */
mysqld-bin.000001	2079	Anonymous_Gtid	1	2152	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2152	Query	1	2268	use `test`; alter table t2 add key uk(i) /* xid=8 */
mysqld-bin.000001	2268	Anonymous_Gtid	1	2341	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2341	Query	1	2475	use `test`; DROP TABLE `t1`,`t2` /* generated by server */ /* xid=9 */
mysqld-bin.000001	2475	Anonymous_Gtid	1	2548	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2548	Query	1	2644	use `test`; optimize table t3
mysqld-bin.000001	2644	Anonymous_Gtid	1	2717	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2717	Query	1	2805	use `test`; analyze table t3
mysqld-bin.000001	2805	Anonymous_Gtid	1	2878	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2878	Query	1	2997	use `test`; alter table t3 add column k int /* xid=12 */
mysqld-bin.000001	2997	Anonymous_Gtid	1	3072	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	3072	Query	1	3154	BEGIN
mysqld-bin.000001	3154	Table_map	1	3203	table_id: 117 (test.t3)
mysqld-bin.000001	3203	Write_rows	1	3256	table_id: 117 flags: STMT_END_F
mysqld-bin.000001	3256	Xid	1	3287	COMMIT /* xid=13 */
#=============================================
#node-2 (check for replication followed by XID)
SHOW BINLOG EVENTS IN 'mysqld-bin.000001' FROM 124;
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
mysqld-bin.000001	124	Previous_gtids	2	155	
mysqld-bin.000001	155	Anonymous_Gtid	1	228	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	228	Query	1	372	use `test`; create table t1 (i int, primary key pk(i)) engine=innodb /* xid=1 */
mysqld-bin.000001	372	Anonymous_Gtid	1	447	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	447	Query	1	524	BEGIN
mysqld-bin.000001	524	Table_map	1	572	table_id: 91 (test.t1)
mysqld-bin.000001	572	Write_rows	1	627	table_id: 91 flags: STMT_END_F
mysqld-bin.000001	627	Xid	1	658	COMMIT /* xid=2 */
mysqld-bin.000001	658	Anonymous_Gtid	1	731	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	731	Query	1	847	use `test`; CREATE TABLE `t2` (
  `i` int(11) NOT NULL
)
mysqld-bin.000001	847	Anonymous_Gtid	1	922	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	922	Query	1	999	BEGIN
mysqld-bin.000001	999	Table_map	1	1047	table_id: 92 (test.t2)
mysqld-bin.000001	1047	Write_rows	1	1102	table_id: 92 flags: STMT_END_F
mysqld-bin.000001	1102	Xid	1	1133	COMMIT /* xid=3 */
mysqld-bin.000001	1133	Anonymous_Gtid	1	1208	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1208	Query	1	1285	BEGIN
mysqld-bin.000001	1285	Table_map	1	1333	table_id: 92 (test.t2)
mysqld-bin.000001	1333	Write_rows	1	1383	table_id: 92 flags: STMT_END_F
mysqld-bin.000001	1383	Xid	1	1414	COMMIT /* xid=4 */
mysqld-bin.000001	1414	Anonymous_Gtid	1	1487	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1487	Query	1	1591	use `test`; create table t3 like t1 /* xid=5 */
mysqld-bin.000001	1591	Anonymous_Gtid	1	1666	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1666	Query	1	1743	BEGIN
mysqld-bin.000001	1743	Table_map	1	1791	table_id: 93 (test.t3)
mysqld-bin.000001	1791	Write_rows	1	1841	table_id: 93 flags: STMT_END_F
mysqld-bin.000001	1841	Xid	1	1872	COMMIT /* xid=6 */
mysqld-bin.000001	1872	Anonymous_Gtid	1	1945	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1945	Query	1	2064	use `test`; alter table t1 add column j int /* xid=7 */
mysqld-bin.000001	2064	Anonymous_Gtid	1	2137	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2137	Query	1	2253	use `test`; alter table t2 add key uk(i) /* xid=8 */
mysqld-bin.000001	2253	Anonymous_Gtid	1	2326	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2326	Query	1	2460	use `test`; DROP TABLE `t1`,`t2` /* generated by server */ /* xid=9 */
mysqld-bin.000001	2460	Anonymous_Gtid	1	2533	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2533	Query	1	2629	use `test`; optimize table t3
mysqld-bin.000001	2629	Anonymous_Gtid	1	2702	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2702	Query	1	2790	use `test`; analyze table t3
mysqld-bin.000001	2790	Anonymous_Gtid	1	2863	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2863	Query	1	2982	use `test`; alter table t3 add column k int /* xid=12 */
mysqld-bin.000001	2982	Anonymous_Gtid	1	3057	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	3057	Query	1	3134	BEGIN
mysqld-bin.000001	3134	Table_map	1	3183	table_id: 99 (test.t3)
mysqld-bin.000001	3183	Write_rows	1	3236	table_id: 99 flags: STMT_END_F
mysqld-bin.000001	3236	Xid	1	3267	COMMIT /* xid=13 */
drop table t3;
