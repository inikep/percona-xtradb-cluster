SET SESSION wsrep_on=OFF;
RESET MASTER;
SET SESSION wsrep_on=ON;
SET SESSION wsrep_on=OFF;
RESET MASTER;
SET SESSION wsrep_on=ON;
#=============================================
#node-1 (fire some basic ddl and dml workload on node-1)
create table t1 (i int, primary key pk(i)) engine=innodb;
insert into t1 values (1), (2), (3), (4);
select * from t1;
i
1
2
3
4
create table t2 as (select * from t1);
insert into t2 values (10), (20), (30);
select * from t2;
i
1
2
3
4
10
20
30
create table t3 like t1;
begin;
insert into t3 values (100), (200), (300);
commit;
alter table t1 add column j int;
alter table t2 add key uk(i);
drop table t1, t2;
optimize table t3;
Table	Op	Msg_type	Msg_text
test.t3	optimize	note	Table does not support optimize, doing recreate + analyze instead
test.t3	optimize	status	OK
analyze table t3;
Table	Op	Msg_type	Msg_text
test.t3	analyze	status	OK
alter table t3 add column k int;
begin;
insert into t3 values (1000, 1000), (2000, 2000);
commit;
select * from t3;
i	k
100	NULL
200	NULL
300	NULL
1000	1000
2000	2000
SHOW BINLOG EVENTS IN 'mysqld-bin.000001' FROM 124;
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
mysqld-bin.000001	124	Previous_gtids	1	155	
mysqld-bin.000001	155	Anonymous_Gtid	1	232	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	232	Query	1	376	use `test`; create table t1 (i int, primary key pk(i)) engine=innodb /* xid=### */
mysqld-bin.000001	376	Anonymous_Gtid	1	455	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	455	Query	1	535	BEGIN
mysqld-bin.000001	535	Table_map	1	583	table_id: ### (test.t1)
mysqld-bin.000001	583	Write_rows	1	638	table_id: ### flags: STMT_END_F
mysqld-bin.000001	638	Xid	1	669	COMMIT /* xid=### */
mysqld-bin.000001	669	Anonymous_Gtid	1	746	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	746	Query	1	862	use `test`; CREATE TABLE `t2` (
  `i` int(11) NOT NULL
)
mysqld-bin.000001	862	Anonymous_Gtid	1	941	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	941	Query	1	1016	BEGIN
mysqld-bin.000001	1016	Table_map	1	1064	table_id: ### (test.t2)
mysqld-bin.000001	1064	Write_rows	1	1119	table_id: ### flags: STMT_END_F
mysqld-bin.000001	1119	Xid	1	1150	COMMIT /* xid=### */
mysqld-bin.000001	1150	Anonymous_Gtid	1	1229	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1229	Query	1	1309	BEGIN
mysqld-bin.000001	1309	Table_map	1	1357	table_id: ### (test.t2)
mysqld-bin.000001	1357	Write_rows	1	1407	table_id: ### flags: STMT_END_F
mysqld-bin.000001	1407	Xid	1	1438	COMMIT /* xid=### */
mysqld-bin.000001	1438	Anonymous_Gtid	1	1515	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1515	Query	1	1619	use `test`; create table t3 like t1 /* xid=### */
mysqld-bin.000001	1619	Anonymous_Gtid	1	1698	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1698	Query	1	1778	BEGIN
mysqld-bin.000001	1778	Table_map	1	1826	table_id: ### (test.t3)
mysqld-bin.000001	1826	Write_rows	1	1876	table_id: ### flags: STMT_END_F
mysqld-bin.000001	1876	Xid	1	1907	COMMIT /* xid=### */
mysqld-bin.000001	1907	Anonymous_Gtid	1	1984	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1984	Query	1	2103	use `test`; alter table t1 add column j int /* xid=### */
mysqld-bin.000001	2103	Anonymous_Gtid	1	2180	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2180	Query	1	2296	use `test`; alter table t2 add key uk(i) /* xid=### */
mysqld-bin.000001	2296	Anonymous_Gtid	1	2373	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2373	Query	1	2505	use `test`; DROP TABLE `t1`,`t2` /* generated by server */ /* xid=### */
mysqld-bin.000001	2505	Anonymous_Gtid	1	2582	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2582	Query	1	2676	use `test`; optimize table t3
mysqld-bin.000001	2676	Anonymous_Gtid	1	2753	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2753	Query	1	2839	use `test`; analyze table t3
mysqld-bin.000001	2839	Anonymous_Gtid	1	2916	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2916	Query	1	3035	use `test`; alter table t3 add column k int /* xid=### */
mysqld-bin.000001	3035	Anonymous_Gtid	1	3114	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	3114	Query	1	3194	BEGIN
mysqld-bin.000001	3194	Table_map	1	3243	table_id: ### (test.t3)
mysqld-bin.000001	3243	Write_rows	1	3296	table_id: ### flags: STMT_END_F
mysqld-bin.000001	3296	Xid	1	3327	COMMIT /* xid=### */
#=============================================
#node-2 (check for replication followed by XID)
SHOW BINLOG EVENTS IN 'mysqld-bin.000001' FROM 124;
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
mysqld-bin.000001	124	Previous_gtids	2	155	
mysqld-bin.000001	155	Anonymous_Gtid	1	232	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	232	Query	1	376	use `test`; create table t1 (i int, primary key pk(i)) engine=innodb /* xid=### */
mysqld-bin.000001	376	Anonymous_Gtid	1	455	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	455	Query	1	530	BEGIN
mysqld-bin.000001	530	Table_map	1	578	table_id: ### (test.t1)
mysqld-bin.000001	578	Write_rows	1	633	table_id: ### flags: STMT_END_F
mysqld-bin.000001	633	Xid	1	664	COMMIT /* xid=### */
mysqld-bin.000001	664	Anonymous_Gtid	1	741	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	741	Query	1	857	use `test`; CREATE TABLE `t2` (
  `i` int(11) NOT NULL
)
mysqld-bin.000001	857	Anonymous_Gtid	1	936	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	936	Query	1	1011	BEGIN
mysqld-bin.000001	1011	Table_map	1	1059	table_id: ### (test.t2)
mysqld-bin.000001	1059	Write_rows	1	1114	table_id: ### flags: STMT_END_F
mysqld-bin.000001	1114	Xid	1	1145	COMMIT /* xid=### */
mysqld-bin.000001	1145	Anonymous_Gtid	1	1224	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1224	Query	1	1299	BEGIN
mysqld-bin.000001	1299	Table_map	1	1347	table_id: ### (test.t2)
mysqld-bin.000001	1347	Write_rows	1	1397	table_id: ### flags: STMT_END_F
mysqld-bin.000001	1397	Xid	1	1428	COMMIT /* xid=### */
mysqld-bin.000001	1428	Anonymous_Gtid	1	1505	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1505	Query	1	1609	use `test`; create table t3 like t1 /* xid=### */
mysqld-bin.000001	1609	Anonymous_Gtid	1	1688	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1688	Query	1	1763	BEGIN
mysqld-bin.000001	1763	Table_map	1	1811	table_id: ### (test.t3)
mysqld-bin.000001	1811	Write_rows	1	1861	table_id: ### flags: STMT_END_F
mysqld-bin.000001	1861	Xid	1	1892	COMMIT /* xid=### */
mysqld-bin.000001	1892	Anonymous_Gtid	1	1969	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	1969	Query	1	2088	use `test`; alter table t1 add column j int /* xid=### */
mysqld-bin.000001	2088	Anonymous_Gtid	1	2165	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2165	Query	1	2281	use `test`; alter table t2 add key uk(i) /* xid=### */
mysqld-bin.000001	2281	Anonymous_Gtid	1	2358	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2358	Query	1	2490	use `test`; DROP TABLE `t1`,`t2` /* generated by server */ /* xid=### */
mysqld-bin.000001	2490	Anonymous_Gtid	1	2567	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2567	Query	1	2661	use `test`; optimize table t3
mysqld-bin.000001	2661	Anonymous_Gtid	1	2738	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2738	Query	1	2824	use `test`; analyze table t3
mysqld-bin.000001	2824	Anonymous_Gtid	1	2901	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	2901	Query	1	3020	use `test`; alter table t3 add column k int /* xid=### */
mysqld-bin.000001	3020	Anonymous_Gtid	1	3099	SET @@SESSION.GTID_NEXT= 'ANONYMOUS'
mysqld-bin.000001	3099	Query	1	3174	BEGIN
mysqld-bin.000001	3174	Table_map	1	3223	table_id: ### (test.t3)
mysqld-bin.000001	3223	Write_rows	1	3276	table_id: ### flags: STMT_END_F
mysqld-bin.000001	3276	Xid	1	3307	COMMIT /* xid=### */
drop table t3;
